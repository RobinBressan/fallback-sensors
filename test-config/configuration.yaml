# Home Assistant test configuration for Fallback Sensors

# Loads default set of integrations. Do not remove.
default_config:

# Load the Lovelace UI
lovelace:
  mode: storage

# Text to speech
tts:
  - platform: google_translate

automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# Logging configuration for debugging
logger:
  default: info
  logs:
    custom_components.fallback_sensors: debug

# Test sensors
sensor:
  # Simulated sensors for testing
  - platform: template
    sensors:
      test_temp_primary:
        friendly_name: "Test Temperature Primary"
        value_template: "{{ 20 + (range(0, 5) | random) }}"
        unit_of_measurement: "°C"
        device_class: temperature

      test_temp_backup:
        friendly_name: "Test Temperature Backup"
        value_template: "{{ 18 + (range(0, 3) | random) }}"
        unit_of_measurement: "°C"
        device_class: temperature

      test_temp_fallback:
        friendly_name: "Test Temperature Fallback"
        value_template: "{{ 22 + (range(0, 2) | random) }}"
        unit_of_measurement: "°C"
        device_class: temperature

  # Example Fallback Sensors configuration (via YAML)
  - platform: fallback_sensors
    name: "Temperature Fallback Test"
    hysteresis_delay: 5
    entities:
      - sensor.test_temp_primary
      - sensor.test_temp_backup
      - sensor.test_temp_fallback
    conditions:
      - type: range
        min: 15
        max: 30

# Input booleans to simulate availability
input_boolean:
  test_primary_available:
    name: Test Primary Sensor Available
    initial: on

  test_backup_available:
    name: Test Backup Sensor Available
    initial: on

# Automations to simulate failures
automation:
  - id: simulate_primary_failure
    alias: Simulate primary sensor failure
    trigger:
      - platform: state
        entity_id: input_boolean.test_primary_available
        to: 'off'
    action:
      - service: sensor.set_value
        target:
          entity_id: sensor.test_temp_primary
        data:
          value: unavailable

  - id: restore_primary
    alias: Restore primary sensor
    trigger:
      - platform: state
        entity_id: input_boolean.test_primary_available
        to: 'on'
    action:
      - service: homeassistant.update_entity
        target:
          entity_id: sensor.test_temp_primary
